## Codebase Patterns
- Use `casts()` method on models rather than `$casts` property (Laravel 12 convention)
- Use PHP 8 generic type hints for relationships: `HasMany<ChildModel, $this>`
- Run `vendor/bin/pint --dirty` for PHP formatting
- Run `npm run build` to verify TypeScript/frontend compiles
- Models need `use HasFactory` trait for factories to work
- Carbon `diffInMinutes()` returns float, cast to int when comparing

---

## 2026-01-13 - US-001
Thread: (Previous iteration - no thread URL)
- Created migrations for `dr_tests` and `dr_test_phases` tables
- Files changed: database/migrations/*_create_dr_tests_table.php, database/migrations/*_create_dr_test_phases_table.php
- **Learnings for future iterations:**
  - dr_test_phases has cascade delete on dr_test_id foreign key
  - duration_minutes is stored as integer, not calculated

---

## 2026-01-13 - US-002
Thread: https://ampcode.com/threads/T-019bb5f0-d413-747f-ab35-6a0fbe741499
- Created DrTest and DrTestPhase Eloquent models with proper relationships
- Files changed: app/Models/DrTest.php, app/Models/DrTestPhase.php
- **Learnings for future iterations:**
  - DrTest->phases() returns HasMany relationship
  - DrTestPhase->drTest() returns BelongsTo relationship
  - test_date is cast to date, started_at/finished_at are cast to datetime

---

## 2026-01-13 - US-003
Thread: https://ampcode.com/threads/T-019bb5f2-9b03-7282-a27a-19bda71eb2cd
- Created DrTestFactory and DrTestPhaseFactory with realistic fake data
- Added HasFactory trait to DrTest and DrTestPhase models
- Created DrTestFactoryTest with 4 test cases to verify factory behavior
- Files changed: database/factories/DrTestFactory.php, database/factories/DrTestPhaseFactory.php, app/Models/DrTest.php, app/Models/DrTestPhase.php, tests/Feature/DrTestFactoryTest.php
- **Learnings for future iterations:**
  - DrTestPhaseFactory generates duration_minutes by calculating from started_at and finished_at difference
  - Use `DrTestPhase::factory()->for($drTest)` to link phase to existing test
  - Use `DrTest::factory()->has(DrTestPhase::factory()->count(3), 'phases')` to create test with phases

---

## 2026-01-13 - US-004
Thread: https://ampcode.com/threads/T-019bb5f4-edd0-711d-a851-a607d2f715b3
- Created kpi_targets migration with kpi_type (unique string) and target_minutes (integer) columns
- Created KpiTarget Eloquent model with fillable fields
- Files changed: database/migrations/2026_01_13_060459_create_kpi_targets_table.php, app/Models/KpiTarget.php
- **Learnings for future iterations:**
  - kpi_type values should be 'rto' or 'rpo'
  - Use `updateOrCreate` for seeding to ensure idempotency (see US-005)

---
