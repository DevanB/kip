## Codebase Patterns
- Use `casts()` method on models rather than `$casts` property (Laravel 12 convention)
- Use PHP 8 generic type hints for relationships: `HasMany<ChildModel, $this>`
- Run `vendor/bin/pint --dirty` for PHP formatting
- Run `npm run build` to verify TypeScript/frontend compiles
- Models need `use HasFactory` trait for factories to work
- Carbon `diffInMinutes()` returns float, cast to int when comparing
- Inertia pages use lowercase names (e.g., 'dashboard' not 'Dashboard')
- Run `php artisan wayfinder:generate` after adding/changing controllers
- Widget components should use shadcn Card (CardHeader, CardTitle, CardDescription, CardContent)

---

## 2026-01-13 - US-001
Thread: (Previous iteration - no thread URL)
- Created migrations for `dr_tests` and `dr_test_phases` tables
- Files changed: database/migrations/*_create_dr_tests_table.php, database/migrations/*_create_dr_test_phases_table.php
- **Learnings for future iterations:**
  - dr_test_phases has cascade delete on dr_test_id foreign key
  - duration_minutes is stored as integer, not calculated

---

## 2026-01-13 - US-002
Thread: https://ampcode.com/threads/T-019bb5f0-d413-747f-ab35-6a0fbe741499
- Created DrTest and DrTestPhase Eloquent models with proper relationships
- Files changed: app/Models/DrTest.php, app/Models/DrTestPhase.php
- **Learnings for future iterations:**
  - DrTest->phases() returns HasMany relationship
  - DrTestPhase->drTest() returns BelongsTo relationship
  - test_date is cast to date, started_at/finished_at are cast to datetime

---

## 2026-01-13 - US-003
Thread: https://ampcode.com/threads/T-019bb5f2-9b03-7282-a27a-19bda71eb2cd
- Created DrTestFactory and DrTestPhaseFactory with realistic fake data
- Added HasFactory trait to DrTest and DrTestPhase models
- Created DrTestFactoryTest with 4 test cases to verify factory behavior
- Files changed: database/factories/DrTestFactory.php, database/factories/DrTestPhaseFactory.php, app/Models/DrTest.php, app/Models/DrTestPhase.php, tests/Feature/DrTestFactoryTest.php
- **Learnings for future iterations:**
  - DrTestPhaseFactory generates duration_minutes by calculating from started_at and finished_at difference
  - Use `DrTestPhase::factory()->for($drTest)` to link phase to existing test
  - Use `DrTest::factory()->has(DrTestPhase::factory()->count(3), 'phases')` to create test with phases

---

## 2026-01-13 - US-004
Thread: https://ampcode.com/threads/T-019bb5f4-edd0-711d-a851-a607d2f715b3
- Created kpi_targets migration with kpi_type (unique string) and target_minutes (integer) columns
- Created KpiTarget Eloquent model with fillable fields
- Files changed: database/migrations/2026_01_13_060459_create_kpi_targets_table.php, app/Models/KpiTarget.php
- **Learnings for future iterations:**
  - kpi_type values should be 'rto' or 'rpo'
  - Use `updateOrCreate` for seeding to ensure idempotency (see US-005)

---

## 2026-01-13 - US-005
Thread: https://ampcode.com/threads/T-019bb5f6-7682-7428-898e-3818c43e77ca
- Created KpiTargetSeeder that seeds RTO and RPO targets of 60 minutes each
- Uses updateOrCreate for idempotency (can run multiple times safely)
- Files changed: database/seeders/KpiTargetSeeder.php
- **Learnings for future iterations:**
  - Run seeder with: `php artisan db:seed --class=KpiTargetSeeder`
  - Default targets are both 60 minutes

---

## 2026-01-13 - US-006
Thread: https://ampcode.com/threads/T-019bb5f7-b193-734c-b0a3-d97492c1d849
- Installed shadcn chart component using `npx shadcn@latest add chart`
- Recharts dependency (^2.15.4) installed in package.json
- Files changed: resources/js/components/ui/chart.tsx, resources/js/components/ui/card.tsx (updated), package.json, package-lock.json
- **Learnings for future iterations:**
  - Use `npx shadcn@latest add chart --yes --overwrite` to avoid prompts
  - Chart component exports: ChartConfig, ChartContainer, ChartTooltip, ChartTooltipContent, ChartLegend, ChartLegendContent, ChartStyle
  - Chart component uses Recharts as underlying library

---

## 2026-01-13 - US-007
Thread: https://ampcode.com/threads/T-019bb5f9-0c3b-7199-9aa8-edf16a21e902
- Created DashboardController with index method that renders 'dashboard' Inertia page
- Updated dashboard.tsx with "DR KPI Dashboard" title and responsive 2-column grid layout
- Updated routes/web.php to use DashboardController instead of inline closure
- Files changed: app/Http/Controllers/DashboardController.php (new), resources/js/pages/dashboard.tsx, routes/web.php
- **Learnings for future iterations:**
  - This codebase uses lowercase page names (e.g., 'dashboard' not 'Dashboard')
  - Existing dashboard uses AppLayout with breadcrumbs pattern
  - Wayfinder auto-generates actions on `php artisan wayfinder:generate`
  - Browser testing requires dev server running (Herd site needs to be parked/linked)

---

## 2026-01-13 - US-008
Thread: https://ampcode.com/threads/T-019bb5fc-ab40-7564-a859-c99a6006715c
- Created RtoWidget component with progress bar, color coding, and target achieved message
- Integrated RtoWidget into dashboard.tsx with DashboardProps interface
- Created .env.testing file to fix test environment
- Files changed: resources/js/components/rto-widget.tsx (new), resources/js/pages/dashboard.tsx, .env.testing (new)
- **Learnings for future iterations:**
  - Widget components should use Card from shadcn/ui for consistent styling
  - getStatusColor logic: green <= target, yellow within 50% above, red > 50% above
  - Progress percentage calculation: 100% when at/below target, decreases as value exceeds target
  - Dashboard props should use defaults (e.g., `targetRto = 60`) for standalone testing

---

## 2026-01-13 - US-009
Thread: https://ampcode.com/threads/T-019bb5ff-5afc-7795-a0bc-996bae8c3d2d
- Created RpoWidget component mirroring RtoWidget structure
- Updated dashboard.tsx to include RpoWidget with latestRpo/targetRpo props
- Files changed: resources/js/components/rpo-widget.tsx (new), resources/js/pages/dashboard.tsx
- **Learnings for future iterations:**
  - RpoWidget and RtoWidget share identical status color/progress logic - could extract to shared utility
  - Dashboard props interface extended with latestRpo and targetRpo (both optional with defaults)

---
